<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TG Memory Duo</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --button-color: var(--tg-theme-button-color, #2481cc);
        }

        body {
            margin: 0;
            padding: 10px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #status {
            margin: 10px 0;
            font-weight: bold;
            text-align: center;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .player-info { padding: 5px 10px; border-radius: 8px; }
        .active-p { background: var(--button-color); color: white; }

        /* –°—ñ—Ç–∫–∞ –≥—Ä–∏ */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 350px;
            width: 100%;
        }

        .card {
            aspect-ratio: 1;
            background-color: var(--button-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: transparent;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
        }

        .card.flipped {
            background-color: var(--hint-color);
            color: white;
            transform: rotateY(180deg);
        }

        .card.matched {
            background-color: #4CAF50;
            visibility: visible;
            color: white;
        }
    </style>
</head>
<body>

    <div id="status">–ß–µ—Ä–≥–∞ –ì—Ä–∞–≤—Ü—è 1</div>

    <div class="stats">
        <div id="p1-info" class="player-info active-p">–ü1: <span id="p1-score">0</span></div>
        <div id="p2-info" class="player-info">–ü2: <span id="p2-score">0</span></div>
    </div>

    <div class="game-grid" id="grid"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        const icons = ['üçé', 'üçå', 'üçí', 'ü•ë', 'ü•¶', 'üçì', 'üçã', 'üçá'];
        let cards = [...icons, ...icons]; // –ü–∞—Ä–∏
        let flippedCards = [];
        let scores = [0, 0];
        let currentPlayer = 0; // 0 –∞–±–æ 1
        let canClick = true;

        // –ü–µ—Ä–µ–º—ñ—à—É–≤–∞–Ω–Ω—è
        cards.sort(() => Math.random() - 0.5);

        const grid = document.getElementById('grid');
        const status = document.getElementById('status');

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫
        cards.forEach((icon, index) => {
            const card = document.createElement('div');
            card.classList.add('card');
            card.dataset.icon = icon;
            card.dataset.index = index;
            card.innerText = icon;
            card.addEventListener('click', () => flipCard(card));
            grid.appendChild(card);
        });

        function flipCard(card) {
            if (!canClick || card.classList.contains('flipped') || card.classList.contains('matched')) return;

            card.classList.add('flipped');
            flippedCards.push(card);

            if (flippedCards.length === 2) {
                canClick = false;
                checkMatch();
            }
        }

        function checkMatch() {
            const [c1, c2] = flippedCards;
            const isMatch = c1.dataset.icon === c2.dataset.icon;

            if (isMatch) {
                c1.classList.add('matched');
                c2.classList.add('matched');
                scores[currentPlayer]++;
                updateUI();
                resetTurn(true);
            } else {
                setTimeout(() => {
                    c1.classList.remove('flipped');
                    c2.classList.remove('flipped');
                    currentPlayer = currentPlayer === 0 ? 1 : 0;
                    updateUI();
                    resetTurn(false);
                }, 1000);
            }
        }

        function resetTurn(keepPlayer) {
            flippedCards = [];
            canClick = true;
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');

            if (document.querySelectorAll('.matched').length === cards.length) {
                status.innerText = "–ì—Ä—É –∑–∞–∫—ñ–Ω—á–µ–Ω–æ!";
            }
        }

        function updateUI() {
            document.getElementById('p1-score').innerText = scores[0];
            document.getElementById('p2-score').innerText = scores[1];

            document.getElementById('p1-info').classList.toggle('active-p', currentPlayer === 0);
            document.getElementById('p2-info').classList.toggle('active-p', currentPlayer === 1);
            status.innerText = `–ß–µ—Ä–≥–∞ –ì—Ä–∞–≤—Ü—è ${currentPlayer + 1}`;
        }
    </script>
</body>
</html>